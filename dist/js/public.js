"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),ScrollLoad=function(){function t(e){var n=this;_classCallCheck(this,t),e.scrollContanier=$(e.scrollContanier),void 0!=e.listContanier&&(e.listContanier=$(e.listContanier));var o={maxload:1e3,perload:27,loading:!1,currentPage:1,listContanier:e.scrollContanier,scrollContanier:e.scrollContanier};e=$.extend({},o,e);for(var i in e)e.hasOwnProperty(i)&&(this[i]=e[i]);this.preloader=$('\n            <div class="infinite-scroll-preloader">\n                <div class="preloader"></div>\n            </div>\n        ').appendTo(this.listContanier),this.perload>this.maxload&&(this.perload=this.maxload),this.scrollContanier.on("scroll",function(){n.scroll()}),this.ajax({openId:$.openId,skip:1,limit:this.perload},function(t){n._ajax(t)})}return _createClass(t,[{key:"_ajax",value:function(t){t.length?(this.currentPage++,this.render(t),t.length<this.perload&&this.finish()):this.finish()}},{key:"scroll",value:function(){var t=this;if(!(this.scrollContanier.scrollTop()+this.scrollContanier.height()+100<this.scrollContanier[0].scrollHeight||this.loading)){if(this.listContanier.children().length>=this.maxload)return void this.finish();this.loading=!0,this.ajax({openId:$.openId,skip:this.currentPage,limit:this.perload},function(e){t.loading=!1,t._ajax(e)})}}},{key:"reload",value:function(){var t=this;this.scrollContanier[0].scrollTop=0,this.preloader.html('<div class="preloader"></div>'),this.currentPage=1,this.loading=!1,this.scrollContanier.on("scroll",function(){t.scroll()}),$.showIndicator(),this.ajax({openId:$.openId,skip:1,limit:this.perload},function(e){t.listContanier.empty(),t._ajax(e),$.hideIndicator()})}},{key:"finish",value:function(){this.scrollContanier.off("scroll");var t=this.preloader[0].offsetTop,e=this.listContanier.height()-parseInt(this.listContanier.css("padding-top"));t>e-10?this.preloader.text("已经到底了！"):this.preloader.text("")}},{key:"render",value:function(t){this.perload<t.length&&(t.length=this.perload);var e=this.template(t);this.listContanier.append(e),this.preloader.appendTo(this.listContanier)}}]),t}();setTimeout(function(){var t=$(".scroll");if(0!=t.length){t.on("touchstart",function(t){var e=$(this)[0],n=e.scrollTop,o=e.scrollHeight,i=n+e.offsetHeight;0===n?e.scrollTop=1:i===o&&(e.scrollTop=n-1)}),t.on("touchmove",function(t){var e=$(this)[0];e.offsetHeight<e.scrollHeight&&(t._isScroller=!0)});var e=$("body").off("touchmove");e.on("touchmove",function(t){t._isScroller||t.preventDefault()})}},100),$(document).on("click",".getMovie",function(){function t(t){var e=$(".movieDetails");e.find(".pic").attr("src",t.MOVIE.poster)}var e=$(this),n=e.attr("movieId");$.ajax({type:"get",url:"http://wechat.94joy.com/wx/rest/index/getMovie",data:{movieId:n},success:function(e){console.log(e),t(e)},error:function(t){console.log("影视详情页获取失败。",t)}})}),$.fn.init=function(t){if(t)for(var e=0;e<this.length;e++){var n=$(this[e]);"img"===this[e].localName?n.attr("src",t):void 0==n.val()?n.text(t):n.val(t),n.removeClass("hide").css("visibility","visible").show()}else this.removeClass("hide").css("visibility","visible")},$.GetQueryString=function(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),n=window.location.search.substr(1).match(e);return null!=n?unescape(n[2]):null},$.openId=$.GetQueryString("openid"),null===$.openId?$.openId=sessionStorage.openId:sessionStorage.openId=$.openId,$.getMovDetails=function(t){return"./movieDetails.html?movieId="+t+"&oldOpenId="+$.openId},$.getArtDetails=function(t){return"./articleDetails.html?articleId="+t+"&oldOpenId="+$.openId},$.msg=function(t,e){var n=t.text||t,o=t.title||"温馨提示",i=t.callback;void 0===e&&(e=t.timeout||2e3);var s=$('\n        <div class="mask">\n            <div class="msg">\n                <p class="msg-title">'+o+'</p>\n                <p class="msg-text">'+n+"</p>\n            </div>\n        </div>\n    ");$("body").append(s),e&&setTimeout(function(){s.remove(),i&&i()},e)},$.payment=function(t){function e(){$.showPreloader("购买中，稍等..."),$.ajax({url:"http://wechat.94joy.com/wx/rest/pay/payByRecharge",data:{openId:$.openId,movieId:t.movieId},success:function(e){console.log("余额支付接口",e),1==e.STATUS?t.success():$.msg("账户余额不足，请充值或使用微信支付！",5e3)},error:function(){$.msg("系统繁忙，请稍后再尝试支付操作！")},complete:function(){$.hidePreloader()}})}var n=[{text:"账户余额支付",onClick:function(){e()}},{text:"微信支付",onClick:function(){t.wxPay.productId=t.productId,$.wxPay(t.wxPay,function(){t.success()})}},{text:"取消"}];$.actions(n)},$.wxPay=function(t,e){var n={type:t.type,title:t.title,openId:$.openId,productId:t.productId,url:location.href.split("#")[0]};console.log("统一下单接口参数",n),$.showIndicator(),$.ajax({url:"http://wechat.94joy.com/movie/rest/pay/toPay",data:n,success:function(t){console.log("统一下单接口：",t),wx.config({appId:t.appId,timestamp:t.timestamp,nonceStr:t.nonceStr,signature:t.signature,jsApiList:["chooseWXPay"]}),wx.ready(function(){wx.chooseWXPay({appId:t.appId,timestamp:t.timestamp,nonceStr:t.nonceStr,package:"prepay_id="+t.prepay_id,signType:t.signType,paySign:t.paySign,success:function(t){"chooseWXPay:ok"==t.errMsg?e():alert(t.errMsg)},cancel:function(t){$.msg("支付取消")},fail:function(){$.msg("充值失败，请小主稍后再试！",5e3)}})})},error:function(t){$.alert("充值服务初始化失败，请稍后再试！"),console.log("充值失败",t)},complete:function(){$.hideIndicator()}})},$.pageInit=function(t){$(t.entry).one("click",function(){t.init()}),location.hash.indexOf(t.hash)>0&&(t.init(),$(t.entry).off("click"))},$.formatAmount=function(t){return t=Number(t),t?t.toFixed(2):"--"},$.getUpdateStatus=function(t,e){return 1==t?e?"第"+e+"集":"更新中":"已完结"};