"use strict";setTimeout(function(){function e(e){for(var t=$(e),n=0;n<t.length;n++){var i=$(t[n]).attr("movieId");console.log("deleteId:"+i),$.ajax({url:"http://wechat.94joy.com/wx/rest/user/delMyMovie",data:{openId:$.openId,movieId:i},success:function(e){console.log(e),1==e.STATUS},error:function(){}})}t.parents("li").remove()}function t(){s=[],a=!1;var e=0;$(".select").each(function(t,n){var i=$(n);if(i.prop("checked")){a=!0,s.push(i.attr("movieid"));var o=parseFloat(i.parents("label").find(".price").text());e+=o}}),a?($(".tools .btn").addClass("active"),l.text(e.toFixed(2))):($(".tools .btn").removeClass("active"),l.text(0))}function n(){var e=$(".list>li");0==e.length&&$(".list,.tools,.edit").hide()}var i=$(".list"),o=$("#payBtn"),l=$("#totalPrice"),s=[];new ScrollLoad({scrollContanier:i,template:function(e){for(var t="",n=0;n<e.length;n++){var i=e[n];t+='\n                <li>\n                    <label for="list-'+(n+1)+'">\n                        <span class="checkbox">\n                            <input type="checkbox" class="select" id="list-'+(n+1)+'" movieId="'+i.id+'">\n                            <label for="list-'+(n+1)+'"></label>\n                        </span>\n                        <div class="listcontent">\n                            <div class="imgbox">\n                                <img src="'+i.poster+'">\n                            </div>\n                            <div class="info">\n                                <h4 class="Title">'+i.title+'</h4>\n                                <span class="text">\n                                    '+i.introduction+'\n                                </span>\n                                <p>\n                                    <span class="site">更新至第'+i.updateSite+'集</span>\n                                    <span class="price">'+Number(i.price).toFixed(2)+'</span>\n                                </p>\n                            </div>\n                            <span class="delete" movieId="'+i.id+'">删除</span>\n                        </div>\n                    </label>\n                </li>\n                '}return t},ajax:function(e,t){var n=$.extend({},e,{state:0});$.ajax({url:"http://wechat.94joy.com/wx/rest/user/myMovie",data:n,cache:!1,success:function(e){e.DATA?t(e.DATA):console.log(window.location.hash+" 没有数据")},error:function(e){console.log(e),$.alert("刷新失败，请稍后再试！")},complete:function(){0==i.children("li").length&&i.hide()}})}});var c=!1,a=!1;$("#selectAll").on("change",function(){var e=$(this);$(".select").prop("checked",e.prop("checked")),t()}),$(document).on("change",".select",function(){t()}),$(".edit").click(function(){c=!c,c?($(this).text("完成"),$(".deleteAll").show(),o.hide()):($(this).text("编辑"),$(".deleteAll").hide(),o.show())}),$(document).on("click",".delete",function(){e(this),t(),n()}),$(".deleteAll").click(function(){e($(".select:checked")),t(),n()}),i.on("swipeLeft","li",function(){$(".delete").removeClass("show"),$(this).find(".delete").addClass("show")}).on("swipeRight","li",function(){$(this).find(".delete").removeClass("show")}),o.click(function(){var e=s[0];if(s.length>1)for(var t=1;t<s.length;t++)e+=","+s[t];$.payment({productId:e,movieId:e,success:function(){$.msg({text:'恭喜，您已购买成功! 5s后跳转"我的影片"，可以去看片了',timeout:5e3,callback:function(){window.location="me.html#page-myMovie"}})},wxPay:{type:1,title:"购物车-影片购买"}})})},100);