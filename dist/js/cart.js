"use strict";setTimeout(function(){function e(e){for(var t=$(e),n=0;n<t.length;n++){var o=$(t[n]).attr("movieId");console.log("deleteId:"+o),$.ajax({url:"http://wechat.94joy.com/wx/rest/user/delMyMovie",data:{openId:$.openId,movieId:o},success:function(e){console.log(e),1==e.STATUS},error:function(){}})}t.parents("li").remove()}function t(){s=[],a=!1;var e=0;$(".select").each(function(t,n){var o=$(n);if(o.prop("checked")){a=!0,s.push(o.attr("movieid"));var l=parseFloat(o.parents("label").find(".price").text());e+=l}}),a?($(".tools .btn").addClass("active"),i.text($.formatAmount(e))):($(".tools .btn").removeClass("active"),i.text(0))}function n(){var e=$(".list>li");0==e.length&&$(".list,.tools,.headerTools").hide()}var o=$(".list"),l=$("#payBtn"),i=$("#totalPrice"),s=[];new ScrollLoad({scrollContanier:o,template:function(e){for(var t="",n=0;n<e.length;n++){var o=e[n];t+='\n                <li>\n                    <label for="list-'+(n+1)+'">\n                        <span class="checkbox">\n                            <input type="checkbox" class="select" id="list-'+(n+1)+'" movieId="'+o.id+'">\n                            <label for="list-'+(n+1)+'"></label>\n                        </span>\n                        <div class="listcontent">\n                            <div class="imgbox">\n                                <img src="'+o.stills+'">\n                            </div>\n                            <div class="info">\n                                <h4 class="Title">'+o.title+'</h4>\n                                <span class="text">\n                                    '+o.introduction+'\n                                </span>\n                                <p>\n                                    <span class="site">'+$.getUpdateStatus(o.updateStatus,o.updateSite)+'</span>\n                                    <span class="price">'+$.formatAmount(o.price)+'</span>\n                                </p>\n                            </div>\n                            <span class="delete" movieId="'+o.id+'">删除</span>\n                        </div>\n                    </label>\n                </li>\n                '}return t},ajax:function(e,t){var n=$.extend({},e,{state:0});$.ajax({url:"http://wechat.94joy.com/wx/rest/user/myMovie",data:n,cache:!1,success:function(e){console.log(e),e.DATA.length>0?(t(e.DATA),$(".headerTools,.tools").init()):console.log(window.location.hash+" 没有数据")},error:function(e){console.log(e),$.alert("刷新失败，请稍后再试！")},complete:function(){0==o.children("li").length&&o.hide()}})}});var c=!1,a=!1;$("#selectAll").on("change",function(){var e=$(this);$(".select").prop("checked",e.prop("checked")),t()}),$(document).on("change",".select",function(){t()}),$(".edit").click(function(){c=!c,c?($(this).text("完成"),$(".deleteAll").show(),l.hide()):($(this).text("编辑"),$(".deleteAll").hide(),l.show())}),$(document).on("click",".delete",function(){e(this),t(),n()}),$(".deleteAll").click(function(){$.confirm("确认清空购物车？",function(){e($(".select:checked")),t(),n()})}),o.on("swipeLeft","li",function(){$(".delete").removeClass("show"),$(this).find(".delete").addClass("show")}).on("swipeRight","li",function(){$(this).find(".delete").removeClass("show")}),l.click(function(){var e=s[0];if(s.length>1)for(var t=1;t<s.length;t++)e+=","+s[t];$.payment({productId:e,movieId:e,success:function(){$.msg({text:'恭喜，您已购买成功! 5s后跳转"我的影片"，可以去看片了',timeout:5e3,callback:function(){window.location="me.html#page-myMovie"}})},wxPay:{type:1,title:"购物车-影片购买"}})})},100);