"use strict";setTimeout(function(){function t(){function t(){$.alert("加入购物车失败，请稍后再试！"),a.prop("disabled",!1)}a.prop("disabled",!0),$.ajax({url:"http://www.funying.cn/wx/rest/index/addMovie",data:{openId:$.openId,movieId:o},success:function(e){1==e.STATUS?$.toast("加入购物车成功"):t()},error:function(){t()}})}function e(t){window.location.href=t}function n(n){var a=n.MOVIE,i=n.MOVIE_SERIES;$("title").text(n.MOVIE.title),$("#qrcode").attr("src",n.QR_CODE),c.removeClass("isBuy"),$.openId||$(".tab-link").last().hide(),1==n.IS_SUBSCRIBE&&$("#qrcodeBox").remove(),1==n.IS_SUBSCRIBE&&1==n.IS_BUY&&$(".tab-link").last().init(),1==n.IS_CART&&$("#addCart").remove(),1==n.IS_BUY?c.addClass("isBuy"):$(".numbox").hide(),$("#getUpdateStatus").init($.getUpdateStatus(a.updateStatus,a.updateSite));for(var s in a){var r=$("#"+s);r.length&&("img"==r[0].localName?r.attr("src",a.stills):r.html(a[s]))}var u=$("#price");u.init($.formatAmount(u.text()));for(var d="",p=0;p<i.length;p++)d+='\n                <a href="javascript:" class="num">'+(p+1)+"</a>\n            ";$(".numbox").html(d),l.on("click",".button-group .btn",function(){var e=$(this);e.hasClass("buy")&&(1==n.IS_SUBSCRIBE?$.payment({productId:o,success:function(){c.addClass("isBuy"),$(".numbox").show(),$.msg("该影片购买成功,您可以在详情页查看资源地址了！",5e3)},wxPay:{type:1,title:"影视详情-影片购买"}}):$.msg("您还不是会员，无法购买，先扫描页面下方二维码成为会员吧！")),e.hasClass("cart")&&(1==n.IS_SUBSCRIBE?t(e):$.msg("您还不是会员，无法加入购物车，先扫描页面下方二维码成为会员吧！"))}),l.on("click",".num",function(){var t=$(this).index(),n=[{text:"主线资源",onClick:function(){e(i[t].resourceUrl)}}];i[t].otherOne&&n.push({text:"备用地址1",onClick:function(){e(i[t].otherOne)}}),i[t].otherTwo&&n.push({text:"备用地址2",onClick:function(){e(i[t].otherTwo)}}),n.push({text:"取消"}),$.actions(n)}),$.shareConfig(function(t){console.log("分享配置",t),wx.config({appId:t.appId,timestamp:t.timestamp,nonceStr:t.noncestr,signature:t.signature,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage"]}),wx.ready(function(){wx.onMenuShareTimeline({title:a.title,imgUrl:a.stills}),wx.onMenuShareAppMessage({title:a.title,desc:a.star,imgUrl:a.stills})})})}var o=$.GetQueryString("movieId"),a=$("#addCart"),i=$("#detail-tab3"),s=$("#feedbackContext"),r=$("#feedbackSubmit"),c=$(".tabs");$.showPreloader();var l=$(".details");$.ajax({url:"http://www.funying.cn/wx/rest/index/getMovie",data:{movieId:o,openId:$.openId,oldOpenId:$.GetQueryString("oldOpenId")},success:function(t){console.log("影视详情数据：",t),1==t.STATUS?n(t):$.alert("没有该影片信息！",function(){$.router.back()})},error:function(t){var e="影视详情页获取失败，稍后再试！";console.log(e,t),$.alert(e,function(){$.router.back()})},complete:function(){$.hidePreloader()}}),i.on("click",".sub-tag span",function(){s.val(s.val()+"#"+$(this).text()+"#")}),r.on("click",function(){var t=$(this);s.val()&&(t.prop("disabled",!0),$.ajax({url:"http://www.funying.cn/wx/rest/index/feedback",data:{context:$("#feedbackContext").val(),movieId:o},success:function(){$.msg("谢谢你的反馈！"),s.val("")},complete:function(){t.prop("disabled",!1)}}))})},100);